type AgentState = variant {
  Idle;
  Bootstrapping;
  ExecutingActions;
  Inferring;
  LoadingContext;
  Faulted;
  Sleeping;
  Persisting;
};
type ContinuationStopReason = variant {
  None;
  MaxDuration;
  InferenceError;
  MaxRounds;
  MaxToolCalls;
};
type ConversationEntry = record {
  timestamp_ns : nat64;
  turn_id : text;
  sender_body : text;
  agent_reply : text;
  inbox_message_id : text;
};
type ConversationLog = record {
  sender : text;
  last_activity_ns : nat64;
  entries : vec ConversationEntry;
};
type ConversationSummary = record {
  sender : text;
  last_activity_ns : nat64;
  entry_count : nat32;
};
type CycleTelemetry = record {
  burn_rate_cycles_per_day : opt nat;
  usd_per_trillion_cycles : float64;
  freezing_threshold_cycles : nat;
  burn_rate_usd_per_day : opt float64;
  window_sample_count : nat32;
  burn_rate_cycles_per_hour : opt nat;
  estimated_seconds_until_freezing_threshold : opt nat64;
  window_duration_seconds : nat64;
  burn_rate_usd_per_hour : opt float64;
  total_cycles : nat;
  estimated_freeze_time_ns : opt nat64;
  moving_window_seconds : nat64;
  liquid_cycles : nat;
};
type EvmRouteStateView = record {
  next_block : nat64;
  automaton_address_topic : opt text;
  automaton_evm_address : opt text;
  chain_id : nat64;
  confirmation_depth : nat64;
  inbox_contract_address : opt text;
  consecutive_empty_polls : nat32;
  last_poll_at_ns : nat64;
  next_log_index : nat64;
};
type HttpRequest = record {
  url : text;
  method : text;
  body : blob;
  headers : vec record { text; text };
  certificate_version : opt nat16;
};
type HttpResponse = record {
  body : blob;
  headers : vec record { text; text };
  upgrade : opt bool;
  status_code : nat16;
};
type HttpUpdateRequest = record {
  url : text;
  method : text;
  body : blob;
  headers : vec record { text; text };
};
type HttpUpdateResponse = record {
  body : blob;
  headers : vec record { text; text };
  status_code : nat16;
};
type InboxMessage = record {
  id : text;
  seq : nat64;
  status : InboxMessageStatus;
  body : text;
  consumed_at_ns : opt nat64;
  posted_at_ns : nat64;
  posted_by : text;
  staged_at_ns : opt nat64;
};
type InboxMessageStatus = variant { Staged; Consumed; Pending };
type InboxStats = record {
  pending_count : nat64;
  consumed_count : nat64;
  total_messages : nat64;
  staged_count : nat64;
};
type InferenceConfigView = record {
  model : text;
  openrouter_max_response_bytes : nat64;
  openrouter_has_api_key : bool;
  provider : InferenceProvider;
  openrouter_base_url : text;
};
type InferenceProvider = variant { OpenRouter; IcLlm };
type InitArgs = record {
  evm_chain_id : opt nat64;
  evm_confirmation_depth : opt nat64;
  evm_rpc_url : opt text;
  ecdsa_key_name : text;
  llm_canister_id : opt principal;
  inbox_contract_address : opt text;
  http_allowed_domains : opt vec text;
};
type JobStatus = variant {
  Skipped;
  Failed;
  Succeeded;
  InFlight;
  TimedOut;
  Pending;
};
type MemoryRollup = record {
  source_count : nat32;
  canonical_value : text;
  window_end_ns : nat64;
  generated_at_ns : nat64;
  window_start_ns : nat64;
  source_keys : vec text;
  namespace : text;
};
type ObservabilitySnapshot = record {
  inbox_stats : InboxStats;
  scheduler : SchedulerRuntime;
  outbox_stats : OutboxStats;
  conversation_summaries : vec ConversationSummary;
  memory_rollups : vec MemoryRollup;
  recent_turns : vec TurnRecord;
  inbox_messages : vec InboxMessage;
  cycles : CycleTelemetry;
  prompt_layers : vec PromptLayerView;
  recent_transitions : vec TransitionLogRecord;
  recent_jobs : vec ScheduledJob;
  captured_at_ns : nat64;
  turn_window_summaries : vec TurnWindowSummary;
  storage_growth : StorageGrowthMetrics;
  outbox_messages : vec OutboxMessage;
  runtime : RuntimeView;
  session_summaries : vec SessionSummary;
};
type OutboxMessage = record {
  id : text;
  seq : nat64;
  body : text;
  source_inbox_ids : vec text;
  created_at_ns : nat64;
  turn_id : text;
};
type OutboxStats = record { total_messages : nat64 };
type PromptLayer = record {
  content : text;
  updated_at_ns : nat64;
  version : nat32;
  updated_by_turn : text;
  layer_id : nat8;
};
type PromptLayerView = record {
  content : text;
  updated_at_ns : opt nat64;
  is_mutable : bool;
  version : opt nat32;
  updated_by_turn : opt text;
  layer_id : nat8;
};
type Result = variant { Ok : text; Err : text };
type Result_1 = variant { Ok : opt text; Err : text };
type Result_2 = variant { Ok : nat64; Err : text };
type Result_3 = variant { Ok : vec text; Err : text };
type Result_4 = variant { Ok : RetentionConfig; Err : text };
type Result_5 = variant { Ok : PromptLayer; Err : text };
type RetentionConfig = record {
  transitions_max_age_secs : nat64;
  turns_max_age_secs : nat64;
  dedupe_max_age_secs : nat64;
  jobs_max_records : nat64;
  maintenance_batch_size : nat32;
  tools_max_age_secs : nat64;
  maintenance_interval_secs : nat64;
  inbox_max_age_secs : nat64;
  outbox_max_age_secs : nat64;
  jobs_max_age_secs : nat64;
};
type RetentionMaintenanceRuntime = record {
  last_error : opt text;
  outbox_scan_cursor : opt text;
  last_deleted_dedupe : nat32;
  last_deleted_inbox : nat32;
  retention_progress_percent : nat8;
  last_generated_session_summaries : nat32;
  dedupe_scan_cursor : opt text;
  inbox_scan_cursor : opt text;
  last_deleted_tools : nat32;
  last_deleted_turns : nat32;
  last_started_ns : opt nat64;
  transition_scan_cursor : opt text;
  job_scan_cursor : opt text;
  last_generated_turn_window_summaries : nat32;
  last_deleted_transitions : nat32;
  last_deleted_outbox : nat32;
  turn_scan_cursor : opt text;
  last_deleted_jobs : nat32;
  last_finished_ns : opt nat64;
  next_run_after_ns : nat64;
  summarization_progress_percent : nat8;
  last_generated_memory_rollups : nat32;
};
type RuntimeView = record {
  last_error : opt text;
  evm_chain_id : nat64;
  last_transition_at_ns : nat64;
  soul : text;
  turn_counter : nat64;
  last_turn_id : opt text;
  state : AgentState;
  inference_provider : InferenceProvider;
  evm_next_log_index : nat64;
  turn_in_flight : bool;
  inference_model : text;
  evm_next_block : nat64;
  loop_enabled : bool;
};
type ScheduledJob = record {
  id : text;
  last_error : opt text;
  status : JobStatus;
  started_at_ns : opt nat64;
  kind : TaskKind;
  lane : TaskLane;
  finished_at_ns : opt nat64;
  attempts : nat32;
  scheduled_for_ns : nat64;
  created_at_ns : nat64;
  max_attempts : nat32;
  priority : nat8;
  dedupe_key : text;
};
type SchedulerLease = record {
  lane : TaskLane;
  acquired_at_ns : nat64;
  job_id : text;
  expires_at_ns : nat64;
};
type SchedulerRuntime = record {
  last_tick_finished_ns : nat64;
  last_tick_error : opt text;
  last_tick_started_ns : nat64;
  survival_tier : SurvivalTier;
  survival_tier_recovery_checks : nat32;
  active_mutating_lease : opt SchedulerLease;
  next_job_seq : nat64;
  enabled : bool;
  paused_reason : opt text;
  low_cycles_mode : bool;
};
type SessionSummary = record {
  source_count : nat32;
  inbox_message_count : nat32;
  outbox_preview : text;
  outbox_message_count : nat32;
  window_end_ns : nat64;
  sender : text;
  generated_at_ns : nat64;
  window_start_ns : nat64;
  inbox_preview : text;
};
type SkillRecord = record {
  name : text;
  description : text;
  instructions : text;
  enabled : bool;
  mutable : bool;
};
type StorageGrowthMetrics = record {
  inbox_staged_queue_entries : nat64;
  memory_fact_limit : nat64;
  turn_map_entries : nat64;
  inbox_pending_queue_entries : nat64;
  pressure_level : StoragePressureLevel;
  memory_rollup_utilization_percent : nat8;
  tracked_entries_delta_per_hour : opt int64;
  retention_progress_percent : nat8;
  session_summary_limit : nat64;
  tracked_entry_count : nat64;
  memory_rollup_entries : nat64;
  outbox_map_entries : nat64;
  session_summary_utilization_percent : nat8;
  turn_window_summary_utilization_percent : nat8;
  memory_fact_entries : nat64;
  memory_fact_utilization_percent : nat8;
  near_limit : bool;
  trend_sample_count : nat32;
  session_summary_entries : nat64;
  dedupe_map_entries : nat64;
  inbox_map_entries : nat64;
  turn_window_summary_entries : nat64;
  pressure_warnings : vec text;
  heap_memory_mb : float64;
  tool_map_entries : nat64;
  runtime_map_entries : nat64;
  stable_memory_mb : float64;
  memory_rollup_limit : nat64;
  transition_map_entries : nat64;
  turn_window_summary_limit : nat64;
  job_map_entries : nat64;
  job_queue_map_entries : nat64;
  trend_window_seconds : nat64;
  summarization_progress_percent : nat8;
};
type StoragePressureLevel = variant { High; Normal; Critical; Elevated };
type SurvivalTier = variant { OutOfCycles; Normal; LowCycles; Critical };
type TaskKind = variant { Reconcile; CheckCycles; PollInbox; AgentTurn };
type TaskLane = variant { ReadOnly; Mutating };
type TaskScheduleConfig = record {
  max_backoff_secs : nat64;
  kind : TaskKind;
  interval_secs : nat64;
  enabled : bool;
  essential : bool;
  priority : nat8;
};
type TaskScheduleRuntime = record {
  backoff_until_ns : opt nat64;
  last_error : opt text;
  next_due_ns : nat64;
  kind : TaskKind;
  last_started_ns : opt nat64;
  pending_job_id : opt text;
  consecutive_failures : nat32;
  last_finished_ns : opt nat64;
};
type ToolCallRecord = record {
  output : text;
  args_json : text;
  tool : text;
  error : opt text;
  turn_id : text;
  success : bool;
};
type TransitionLogRecord = record {
  id : text;
  occurred_at_ns : nat64;
  to_state : AgentState;
  error : opt text;
  event : text;
  turn_id : text;
  from_state : AgentState;
};
type TurnRecord = record {
  id : text;
  inference_round_count : nat32;
  continuation_stop_reason : ContinuationStopReason;
  state_to : AgentState;
  input_summary : text;
  error : opt text;
  inner_dialogue : opt text;
  created_at_ns : nat64;
  source_events : nat32;
  state_from : AgentState;
  tool_call_count : nat32;
};
type TurnWindowSummary = record {
  tool_success_count : nat32;
  source_count : nat32;
  failed_turn_count : nat32;
  turn_count : nat32;
  transition_count : nat32;
  window_end_ns : nat64;
  top_errors : vec text;
  generated_at_ns : nat64;
  window_start_ns : nat64;
  succeeded_turn_count : nat32;
  tool_failure_count : nat32;
  tool_call_count : nat32;
};
type WalletBalanceStatus = variant { Error; Stale; Fresh; Unknown };
type WalletBalanceSyncConfigView = record {
  normal_interval_secs : nat64;
  max_response_bytes : nat64;
  enabled : bool;
  discover_usdc_via_inbox : bool;
  freshness_window_secs : nat64;
  low_cycles_interval_secs : nat64;
};
type WalletBalanceTelemetryView = record {
  last_error : opt text;
  status : WalletBalanceStatus;
  usdc_contract_address : opt text;
  eth_balance_wei_hex : opt text;
  usdc_balance_raw_hex : opt text;
  last_synced_at_ns : opt nat64;
  bootstrap_pending : bool;
  usdc_decimals : nat8;
  is_stale : bool;
  freshness_window_secs : nat64;
  age_secs : opt nat64;
  last_synced_block : opt nat64;
};
service : (InitArgs) -> {
  get_automaton_evm_address : () -> (opt text) query;
  get_conversation : (text) -> (opt ConversationLog) query;
  get_evm_route_state_view : () -> (EvmRouteStateView) query;
  get_inbox_stats : () -> (InboxStats) query;
  get_inference_config : () -> (InferenceConfigView) query;
  get_observability_snapshot : (nat32) -> (ObservabilitySnapshot) query;
  get_outbox_stats : () -> (OutboxStats) query;
  get_prompt_layers : () -> (vec PromptLayerView) query;
  get_retention_config : () -> (RetentionConfig) query;
  get_retention_maintenance_runtime : () -> (RetentionMaintenanceRuntime) query;
  get_runtime_view : () -> (RuntimeView) query;
  get_scheduler_view : () -> (SchedulerRuntime) query;
  get_soul : () -> (text) query;
  get_tool_calls_for_turn : (text) -> (vec ToolCallRecord) query;
  get_wallet_balance_sync_config : () -> (WalletBalanceSyncConfigView) query;
  get_wallet_balance_telemetry : () -> (WalletBalanceTelemetryView) query;
  http_request : (HttpRequest) -> (HttpResponse) query;
  http_request_update : (HttpUpdateRequest) -> (HttpUpdateResponse);
  list_conversations : () -> (vec ConversationSummary) query;
  list_inbox_messages : (nat32) -> (vec InboxMessage) query;
  list_memory_rollups : (nat32) -> (vec MemoryRollup) query;
  list_outbox_messages : (nat32) -> (vec OutboxMessage) query;
  list_recent_events : (nat32) -> (vec text) query;
  list_scheduler_jobs : (nat32) -> (vec ScheduledJob) query;
  list_session_summaries : (nat32) -> (vec SessionSummary) query;
  list_skills : () -> (vec SkillRecord) query;
  list_task_schedules : () -> (
      vec record { TaskScheduleConfig; TaskScheduleRuntime },
    ) query;
  list_tool_policies : () -> (vec text) query;
  list_turn_window_summaries : (nat32) -> (vec TurnWindowSummary) query;
  list_turns : (nat32) -> (vec text) query;
  post_inbox_message : (text) -> (Result);
  set_automaton_evm_address_admin : (opt text) -> (Result_1);
  set_evm_chain_id_admin : (nat64) -> (Result_2);
  set_evm_confirmation_depth_admin : (nat64) -> (Result_2);
  set_evm_rpc_fallback_url : (opt text) -> (Result_1);
  set_evm_rpc_max_response_bytes : (nat64) -> (Result_2);
  set_evm_rpc_url : (text) -> (Result);
  set_http_allowed_domains : (vec text) -> (Result_3);
  set_inbox_contract_address_admin : (opt text) -> (Result_1);
  set_inference_model : (text) -> (Result);
  set_inference_provider : (InferenceProvider) -> (text);
  set_loop_enabled : (bool) -> (text);
  set_openrouter_api_key : (opt text) -> (text);
  set_openrouter_base_url : (text) -> (Result);
  set_retention_config : (RetentionConfig) -> (Result_4);
  set_scheduler_enabled : (bool) -> (text);
  set_scheduler_low_cycles_mode : (bool) -> (text);
  set_task_enabled : (TaskKind, bool) -> (text);
  set_task_interval_secs : (TaskKind, nat64) -> (Result);
  update_prompt_layer_admin : (nat8, text) -> (Result_5);
  update_soul : (text) -> (Result);
}
